<!-- templates/students/watch_student_list.html -->
{% extends "base.html" %}

{% block title %}{{ content.title }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css\viewReports\viewReport.css') }}">

<style>
    .dashboard {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 2rem;
        background: #f8fafc;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 2rem;
        margin: 2rem 0;
    }

    .chart-container {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .stats-card {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    h1, h2 {
        color: #1e293b;
        margin-bottom: 1.5rem;
    }

    button {
        background: #3b82f6;
        color: white;
        padding: 0.8rem 1.5rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.3s;
    }

    button:hover {
        background: #2563eb;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
    }

    th, td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid #e2e8f0;
    }

    th {
        background: #f1f5f9;
    }
</style>

    <div class="dashboard">
        <h1>Análisis Demostrativo de Ventas (Datos Ficticios)</h1>
        
        <div class="grid">
            <div class="stats-card">
                <h2>Resumen Estadístico</h2>
                <table>
                    <tr><td>Período analizado</td><td>2020-2024</td></tr>
                    <tr><td>Ventas promedio</td><td id="avgSales">$4,500</td></tr>
                    <tr><td>Máximo histórico</td><td id="maxSales">$7,200</td></tr>
                    <tr><td>Mínimo histórico</td><td id="minSales">$2,100</td></tr>
                    <tr><td>Predicción próximo trimestre</td><td id="prediction">$5,400 ± $300</td></tr>
                </table>
            </div>
            
            <div class="stats-card">
                <h2>Tendencia Anual</h2>
                <canvas id="annualChart"></canvas>
            </div>
        </div>

        <div class="chart-container">
            <h2>Serie Temporal con Predicción</h2>
            <canvas id="timeSeriesChart"></canvas>
            <button onclick="generateNewData()">Generar Nueva Simulación</button>
        </div>

        <div class="chart-container" style="margin-top: 2rem;">
            <h2>Descomposición Estacional</h2>
            <canvas id="seasonalityChart"></canvas>
        </div>
    </div>

<script>
// Datos ficticios iniciales
let historicalData = [];
let forecastData = [];
let annualData = [];
let ctx1, ctx2, ctx3;
let timeSeriesChart, annualChart, seasonalityChart;

function generateMockData() {
    // Generar datos históricos
    historicalData = [];
    let date = new Date(2020, 0, 1);
    let baseValue = 3000;
    
    for (let i = 0; i < 48; i++) {
        let seasonal = Math.sin(i / 12 * Math.PI) * 1000;
        let noise = Math.random() * 500 - 250;
        let trend = i * 50;
        
        historicalData.push({
            date: new Date(date),
            value: baseValue + seasonal + noise + trend
        });
        date.setMonth(date.getMonth() + 1);
    }

    // Generar predicción
    forecastData = [];
    for (let i = 0; i < 12; i++) {
        forecastData.push({
            date: new Date(date),
            yhat: 6000 + Math.sin(i / 12 * Math.PI) * 1000 + i * 50 + Math.random() * 300 - 150,
            yhat_lower: 6000 + Math.sin(i / 12 * Math.PI) * 800 + i * 50 - 200,
            yhat_upper: 6000 + Math.sin(i / 12 * Math.PI) * 1200 + i * 50 + 200
        });
        date.setMonth(date.getMonth() + 1);
    }

    // Generar datos anuales
    annualData = [];
    for (let year = 2020; year <= 2023; year++) {
        annualData.push({
            year: year,
            sales: 4000 + (year - 2020) * 1000 + Math.random() * 500
        });
    }

    updateStats();
}

function updateStats() {
    const values = historicalData.map(d => d.value);
    document.getElementById('avgSales').textContent = `$${(values.reduce((a,b) => a + b, 0)/values.length).toFixed(0)}`;
    document.getElementById('maxSales').textContent = `$${Math.max(...values).toFixed(0)}`;
    document.getElementById('minSales').textContent = `$${Math.min(...values).toFixed(0)}`;
    document.getElementById('prediction').textContent = `$${forecastData[0].yhat.toFixed(0)} ± $300`;
}

function renderCharts() {
    // Destruir gráficos anteriores si existen
    if (timeSeriesChart) timeSeriesChart.destroy();
    if (annualChart) annualChart.destroy();
    if (seasonalityChart) seasonalityChart.destroy();

    // Gráfico de serie temporal
    ctx1 = document.getElementById('timeSeriesChart').getContext('2d');
    timeSeriesChart = new Chart(ctx1, {
        type: 'line',
        data: {
            labels: [...historicalData.map(d => d.date.toLocaleDateString('es-ES', {month: 'short', year: 'numeric'})), 
                    ...forecastData.map(d => d.date.toLocaleDateString('es-ES', {month: 'short', year: 'numeric'}))],
            datasets: [{
                label: 'Ventas Históricas',
                data: [...historicalData.map(d => d.value), ...Array(forecastData.length).fill(null)],
                borderColor: '#3b82f6',
                tension: 0.1
            }, {
                label: 'Predicción',
                data: [...Array(historicalData.length).fill(null), ...forecastData.map(d => d.yhat)],
                borderColor: '#ef4444',
                borderDash: [5, 5],
                tension: 0.1
            }, {
                label: 'Intervalo de Confianza',
                data: [...Array(historicalData.length).fill(null), ...forecastData.map(d => d.yhat_upper)],
                borderColor: '#94a3b8',
                borderDash: [2, 2],
                tension: 0.1,
                fill: '-1',
                pointRadius: 0
            }]
        }
    });

    // Gráfico anual
    ctx2 = document.getElementById('annualChart').getContext('2d');
    annualChart = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: annualData.map(d => d.year),
            datasets: [{
                label: 'Ventas Anuales',
                data: annualData.map(d => d.sales),
                backgroundColor: '#3b82f6'
            }]
        }
    });

    // Gráfico de descomposición estacional
    ctx3 = document.getElementById('seasonalityChart').getContext('2d');
    seasonalityChart = new Chart(ctx3, {
        type: 'line',
        data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
            datasets: [{
                label: 'Patrón Estacional',
                data: Array(12).fill().map((_,i) => Math.sin(i / 12 * Math.PI) * 1000 + 500),
                borderColor: '#10b981',
                tension: 0.1
            }]
        }
    });
}

function generateNewData() {
    generateMockData();
    renderCharts();
}

// Inicialización
generateMockData();
renderCharts();
</script>
{% endblock %}